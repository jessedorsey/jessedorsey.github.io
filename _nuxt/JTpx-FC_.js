import{h as Z}from"./D1je55df.js";import{d as ee,b as w,e as A,ao as H,f as te,g as ae,i as ne,t as oe,a4 as se,ap as le,a8 as ie,k as re,E as I,aq as q,ar as Ae,ab as ce,w as ue,P as de,L as fe,q as z,$ as pe,I as V,at as ve}from"./BMw0ieou.js";const me={trailing:!0};function he(t,l=25,r={}){if(r={...me,...r},!Number.isFinite(l))throw new TypeError("Expected `wait` to be a finite number");let b,f,c=[],u,_;const p=(v,s)=>(u=ye(t,v,s),u.finally(()=>{if(u=null,r.trailing&&_&&!f){const E=p(v,_);return _=null,E}}),u);return function(...v){return u?(r.trailing&&(_=v),u):new Promise(s=>{const E=!f&&r.leading;clearTimeout(f),f=setTimeout(()=>{f=null;const R=r.leading?b:p(this,v);for(const m of c)m(R);c=[]},l),E?(b=p(this,v),s(b)):c.push(s)})}}async function ye(t,l,r){return await t.apply(l,r)}const S="_islandPromises",J=/data-island-uid="([^"]*)"/,ge=/data-island-uid(="")?(?!="[^"])/g,_e=/data-island-slot="([^"]*)"/g,we=/ data-island-slot="([^"]*)"[^>]*>/g,Se=/^<[^> ]*/;let be=1;const Ee=()=>(be++).toString();const $e=ee({name:"NuxtIsland",inheritAttrs:!1,props:{name:{type:String,required:!0},lazy:Boolean,props:{type:Object,default:()=>{}},context:{type:Object,default:()=>({})},scopeId:{type:String,default:()=>{}},source:{type:String,default:()=>{}},dangerouslyLoadClientComponents:{type:Boolean,default:!1}},emits:["error"],async setup(t,{slots:l,expose:r,emit:b}){var T,j,k,N,P,D;let f=!1;const c=w(0),u=w(0),_=A(()=>H),p=w(null),v=fe(),s=te(),E=A(()=>t.props?Object.fromEntries(Object.entries(t.props).filter(([n])=>!n.startsWith("data-v-"))):{}),R=A(()=>Z([t.name,E.value,t.context,t.source]).replace(/[-_]/g,"")),m=oe(),Re=void 0;let L;const K=globalThis.fetch,O=w(!1);ae(()=>{O.value=!0,c.value++}),ne(()=>{L&&L.dispose()});function Q(n,e){const o={};e.props&&(o.props=e.props),e.slots&&(o.slots=e.slots),e.components&&(o.components=e.components),e.head&&(o.head=e.head),s.payload.data[n]={__nuxt_island:{key:n,params:{...t.context,props:t.props?JSON.stringify(t.props):void 0},result:o},...e}}const h={};if(m.vnode.el){const n=(T=se(s.payload.data[`${t.name}_${R.value}`]))==null?void 0:T.slots;n&&(h.slots=n)}const y=w("");if((j=m.vnode)!=null&&j.el){y.value=((k=le(m.vnode.el,!0))==null?void 0:k.join(""))||"";const n=`${t.name}_${R.value}`;(N=s.payload.data)[n]||(N[n]={}),s.payload.data[n].html=y.value.replaceAll(new RegExp(`data-island-uid="${((P=y.value.match(J))==null?void 0:P[1])||""}"`,"g"),'data-island-uid=""')}const g=w(((D=y.value.match(J))==null?void 0:D[1])||Ee()),W=A(()=>[...y.value.matchAll(_e)].map(n=>n[1])),$=A(()=>{const n=Object.keys(l);let e=y.value;if(t.scopeId&&(e=e.replace(Se,o=>o+" "+t.scopeId)),!_.value)for(const[o,a]of Object.entries(h.components||{}))e=e.replace(new RegExp(` data-island-uid="${g.value}" data-island-component="${o}"[^>]*>`),d=>d+a.html);return h.slots?e.replaceAll(we,(o,a)=>{var d,i;return n.includes(a)?o:o+(((i=(d=h.slots)==null?void 0:d[a])==null?void 0:i.fallback)||"")}):e}),G=ie();async function X(n=!1){var d;const e=`${t.name}_${R.value}`;if(!n&&((d=s.payload.data[e])!=null&&d.html))return s.payload.data[e];const o=`/__nuxt_island/${e}.json`,a=await K(ue(t.source?o:de(v.app.baseURL??"",o),{...t.context,props:t.props?JSON.stringify(t.props):void 0}));try{const i=await a.json();return Q(e,i),i}catch(i){throw a.status!==200?new Error(i.toString(),{cause:a}):i}}async function C(n=!1){var e,o;s[S]||(s[S]={}),(e=s[S])[o=g.value]||(e[o]=X(n).finally(()=>{delete s[S][g.value]}));try{const a=await s[S][g.value];y.value=a.html.replaceAll(ge,`data-island-uid="${g.value}"`),u.value++,p.value=null,h.slots=a.slots||{},h.components=a.components||{},a!=null&&a.head&&(L?L.patch(a.head):L=G.push(a.head)),ce(()=>{f=!0,c.value++})}catch(a){p.value=a,b("error",a)}}return r({refresh:()=>C(!0)}),re(t,he(()=>C(),100),{deep:!0}),!m.vnode.el&&t.lazy?C():(!m.vnode.el||!s.payload.serverRendered)&&await C(),(n,e)=>{var o;return!$.value||p.value?[((o=l.fallback)==null?void 0:o.call(l,{error:p.value}))??I("div")]:[q([u.value],()=>I(V,{key:u.value},[z(pe($.value||"<div></div>",1))]),e,0),q([c.value],()=>{var i;const a=[],d=c.value===0||!!(c.value&&!(c.value%2));if(g.value&&$.value&&(t.lazy?f:O.value||(i=m.vnode)!=null&&i.el))for(const x in l)W.value.includes(x)&&a.push(I(ve,{to:`${d?"div":""}[data-island-uid="${g.value}"][data-island-slot="${x}"]`},{default:()=>{var U,F,B;return((B=(F=(U=h.slots)==null?void 0:U[x])==null?void 0:F.props)!=null&&B.length?h.slots[x].props:[{}]).map(Y=>{var M;return(M=l[x])==null?void 0:M.call(l,Y)})}}));return z(V,a)},e,1)]}}});export{$e as default};
