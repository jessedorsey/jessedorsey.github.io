import{w as D,b as v,e as O,a0 as h,g as ee,k as y,i as ae,c as re,o as te,a1 as oe,r as w,j as F,a2 as ie,a as W,n as ne,a3 as se,h as G,E as le,m as ce,a4 as R}from"./C-c69ZSP.js";import{h as $}from"./D1je55df.js";import{u as pe,o as ue,a as P,s as b,d as ge,l as j,e as de,c as me}from"./CIssy2MP.js";import{u as fe}from"./CEGqgr6m.js";import ve from"./BM40XCOf.js";import"./CgnYQYOB.js";import"./DlAUqK2U.js";ue({apiKey:b(),libraries:P(de(b())),language:P(b()),region:P(b()),v:P(ge([j("weekly"),j("quarterly"),j("beta"),j("alpha"),b()]))});function ye(A){let M=Promise.resolve();return pe("googleMaps",n=>{const o=(n==null?void 0:n.libraries)||["places"],k=n!=null&&n.language?{language:n.language}:void 0,L=n!=null&&n.region?{region:n.region}:void 0,p=n!=null&&n.v?{v:n.v}:void 0;return{scriptInput:{src:D("https://maps.googleapis.com/maps/api/js",{libraries:o.join(","),key:n==null?void 0:n.apiKey,loading:"async",callback:"google.maps.__ib__",...k,...L,...p})},clientInit:()=>{window.google=window.google||{},window.google.maps=window.google.maps||{},M=new Promise(S=>{window.google.maps.__ib__=S})},schema:void 0,scriptOptions:{use(){return{maps:M.then(()=>window.google.maps)}}}}},A)}const $e={__name:"ScriptGoogleMaps",props:{trigger:{type:[String,Array,Boolean],required:!1,default:["mouseenter","mouseover","mousedown"]},aboveTheFold:{type:Boolean,required:!1},apiKey:{type:String,required:!1},center:{type:null,required:!1},centerMarker:{type:Boolean,required:!1},mapOptions:{type:null,required:!1},region:{type:String,required:!1},language:{type:String,required:!1},version:{type:String,required:!1},width:{type:[Number,String],required:!1,default:640},height:{type:[Number,String],required:!1,default:400},placeholderOptions:{type:Object,required:!1},placeholderAttrs:{type:Object,required:!1},rootAttrs:{type:Object,required:!1},markers:{type:Array,required:!1}},emits:["ready","error"],setup(A,{expose:M,emit:n}){var H;const o=A,k=n,L=o.apiKey||((H=me("googleMaps"))==null?void 0:H.apiKey),p=v(),S=v(),B=v(),E=v(),q=fe({trigger:o.trigger,el:S}),{load:U,status:d,onLoaded:J}=ye({apiKey:o.apiKey,scriptOptions:{trigger:q},region:o.region,language:o.language,v:o.version}),u=O(()=>{var e;return h({center:E.value},o.mapOptions,{center:o.center,zoom:15,mapId:(e=o.mapOptions)!=null&&e.styles?void 0:"map"})}),m=v(!1),s=v(),c=v(new Map);function K(e){return typeof e=="string"&&(e.split(",").length>2||e.includes("+"))}function T(e){return new Promise(async a=>{const r=e instanceof Promise?await e:e;r&&r.setMap(null),a()})}function I(e){const a=typeof e=="string"?{position:{lat:Number.parseFloat(e.split(",")[0]||"0"),lng:Number.parseFloat(e.split(",")[1]||"0")}}:e;return a.position||(a.position={lat:0,lng:0}),a}async function z(e){if(!e)return;const a=I(e),r=$({position:a.position});if(c.value.has(r))return c.value.get(r);const t=new Promise(async i=>{const l=await x("marker"),g=h(R(a),{map:R(s.value),position:a.location});i(new l.AdvancedMarkerElement(g))});return c.value.set(r,t),t}const N=new Map;async function C(e){return e&&typeof e=="object"?Promise.resolve(e):N.has(e)?Promise.resolve(N.get(e)):new Promise(async(a,r)=>{p.value||(await U(),await new Promise(i=>{const l=y(p,()=>{l(),i()})})),new p.value.places.PlacesService(s.value).findPlaceFromQuery({query:e,fields:["name","geometry"]},(i,l)=>{var g,f;return l==="OK"&&((f=(g=i==null?void 0:i[0])==null?void 0:g.geometry)!=null&&f.location)?a(i[0].geometry.location):r(new Error(`No location found for ${e}`))})}).then(a=>(N.set(e,a),a))}const _=new Map;function x(e){var r;if(_.has(e))return _.get(e);const a=((r=p.value)==null?void 0:r.importLibrary(e))||new Promise(t=>{const i=y(p,l=>{if(l){const g=l.importLibrary(e);t(g),i()}},{immediate:!0})});return _.set(e,a),a}const Q={googleMaps:p,map:s,createAdvancedMapMarker:z,resolveQueryToLatLang:C,importLibrary:x};M(Q),ee(()=>{y(m,e=>{e&&k("ready",Q)}),y(d,e=>{e==="error"&&k("error")}),y(u,()=>{var e;(e=s.value)==null||e.setOptions(u.value)}),y([()=>o.markers,s],async()=>{if(!s.value)return;const e=new Map((o.markers||[]).map(i=>[$({position:I(i).position}),i])),a=new Set([...c.value.keys()].filter(i=>!e.has(i))),r=new Set([...e.keys()].filter(i=>!c.value.has(i))),t=$({position:u.value.center});for(const i of a){if(i===t)continue;const l=await c.value.get(i);l&&T(l).then(()=>{c.value.delete(i)})}for(const i of r)z(e.get(i))},{immediate:!0,deep:!0}),y([()=>u.value.center,m,s],async(e,a)=>{if(!s.value)return;let r=R(e[0]);if(r&&(K(r)&&m.value&&(r=await C(r)),s.value.setCenter(r),typeof o.centerMarker>"u"||o.centerMarker)){if(u.value.mapId)return;if(a[0]){const t=$({position:a[0]});c.value.has(t)&&T(c.value.get(t)).then(()=>{c.value.delete(t)})}z({position:r})}},{immediate:!0}),J(async e=>{var t;p.value=await e.maps;const a=u.value.center,r={...u.value,center:!a||K(a)?void 0:a};s.value=new p.value.Map(B.value,r),a&&K(a)&&(E.value=await C(a),(t=s.value)==null||t.setCenter(E.value)),m.value=!0})});function X(e){return e.map(a=>{const r=a.featureType?`feature:${a.featureType}`:"",t=a.elementType?`element:${a.elementType}`:"",i=(a.stylers||[]).map(l=>Object.entries(l).map(([g,f])=>(g==="color"&&typeof f=="string"&&(f=f.replace("#","0x")),`${g}:${f}`)).join("|")).filter(Boolean).join("|");return[r,t,i].filter(Boolean).join("|")}).filter(Boolean)}const V=O(()=>{var r;let e=u.value.center;e&&typeof e=="object"&&(e=`${e.lat},${e.lng}`);const a=h(o.placeholderOptions,{zoom:u.value.zoom,center:e},{size:`${o.width}x${o.height}`,key:L,scale:2,style:(r=o.mapOptions)!=null&&r.styles?X(o.mapOptions.styles):void 0,markers:[...o.markers||[],e].filter(Boolean).map(t=>(typeof t=="object"&&t.location&&(t=t.location),typeof t=="object"&&t.lat?`${t.lat},${t.lng}`:t)).join("|")});return D("https://maps.googleapis.com/maps/api/staticmap",a)}),Y=O(()=>h(o.placeholderAttrs,{src:V.value,alt:"Google Maps Static Map",loading:o.aboveTheFold?"eager":"lazy",style:{cursor:"pointer",width:"100%",objectFit:"cover",height:"100%"}})),Z=O(()=>h(o.rootAttrs,{"aria-busy":d.value==="loading","aria-label":d.value==="awaitingLoad"?"Google Maps Static Map":d.value==="loading"?"Google Maps Map Embed Loading":"Google Maps Embed","aria-live":"polite",role:"application",style:{cursor:"pointer",position:"relative",maxWidth:"100%",width:`${o.width}px`,height:"'auto'",aspectRatio:`${o.width}/${o.height}`},...q instanceof Promise?q.ssrAttrs||{}:{}}));return ae(async()=>{var e,a,r;await Promise.all([...c.value.entries()].map(([,t])=>T(t))),c.value.clear(),(e=s.value)==null||e.unbindAll(),s.value=void 0,(r=(a=B.value)==null?void 0:a.firstChild)==null||r.remove()}),(e,a)=>(te(),re("div",ce({ref_key:"rootEl",ref:S},Z.value),[oe(W("div",{ref_key:"mapEl",ref:B,style:{width:"100%",height:"100%",maxWidth:"100%"}},null,512),[[ie,m.value]]),m.value?F("",!0):w(e.$slots,"placeholder",{key:0,placeholder:V.value},()=>[W("img",ne(se(Y.value)),null,16)]),G(d)!=="awaitingLoad"&&!m.value?w(e.$slots,"loading",{key:1},()=>[le(ve)]):F("",!0),G(d)==="awaitingLoad"?w(e.$slots,"awaitingLoad",{key:2}):G(d)==="error"?w(e.$slots,"error",{key:3}):F("",!0),w(e.$slots,"default")],16))}};export{$e as default};
